window.quizQuestions = [
    {
        question: "Hola, Julio. ¿Cómo _____ esta mañana?",
        options: [
            "te sentirías",
            "te encuentras",
            "saldrían",
            "contaría"
        ],
        correct: 1
    },
    {
        question: "¿Qué tipo de palabra es 'rápidamente'?",
        options: [
            "Sustantivo",
            "Adjetivo",
            "Adverbio",
            "Verbo"
        ],
        correct: 2
    },
    {
        question: "Identifica el sujeto en: 'Los pájaros cantan en el árbol'",
        options: [
            "En el árbol",
            "Cantan",
            "Los pájaros",
            "No tiene sujeto"
        ],
        correct: 2
    },
    {
        question: "¿Qué función cumple 'con cariño' en 'Escribió la carta con cariño'?",
        options: [
            "Sujeto",
            "Complemento directo",
            "Complemento circunstancial",
            "Predicado"
        ],
        correct: 2
    },
    {
        question: "¿Cuál es el modo verbal en 'Ojalá llueva mañana'?",
        options: [
            "Indicativo",
            "Subjuntivo",
            "Imperativo",
            "Condicional"
        ],
        correct: 1
    },
    {
        question: "Observa la imagen de la niña bailando. ¿Qué oración describe mejor la escena?",
        image: "img/quiz/dance.png",
        options: [
            "La niña está saltando en la sala",
            "La niña está practicando sus pasos de baile en la sala",
            "La niña está haciendo ejercicio",
            "La niña está jugando en la sala"
        ],
        correct: 1,
        category: "descripción_acciones"
    },
    {
        question: "La chica con la cámara está sonriendo. ¿Qué expresión usarías para describir su estado de ánimo?",
        image: "img/quiz/camera.png",
        options: [
            "Está que no cabe en sí de gozo",
            "Está como pez en el agua",
            "Está que se sube por las paredes",
            "Está que echa chispas"
        ],
        correct: 0,
        category: "expresiones_idiomáticas"
    },
    {
        question: "En el aeropuerto, ¿qué situación refleja la imagen?",
        image: "img/quiz/airport.png",
        options: [
            "El pasajero está haciendo el check-in",
            "La azafata está dando indicaciones sobre la puerta de embarque",
            "El hombre está comprando un billete",
            "Están revisando la documentación"
        ],
        correct: 1,
        category: "situaciones_cotidianas"
    },
    {
        question: "En el pueblo andino, los turistas probablemente están...",
        image: "img/quiz/tourists.png",
        options: [
            "Preguntando por direcciones al centro",
            "Regateando el precio de las artesanías",
            "Pidiendo recomendaciones de restaurantes",
            "Consultando sobre el clima local"
        ],
        correct: 1,
        category: "interacción_cultural"
    },
    {
        question: "En el tren, ¿qué detalle NO corresponde con la imagen?",
        image: "img/quiz/train.png",
        options: [
            "Hay tres pasajeros en el vagón",
            "Dos personas están despiertas",
            "Uno de los pasajeros tiene un brazo enyesado",
            "Un pasajero está leyendo"
        ],
        correct: 1,
        category: "comprensión_detalles"
    },
    {
        question: "Sobre la imagen del gato, elige la descripción que utiliza correctamente los marcadores espaciales:",
        image: "img/quiz/cat.png",
        options: [
            "El gato está acostado sobre la alfombra, entre la cama y el escritorio, mientras las lámparas iluminan el cuarto",
            "El gato está en la alfombra, la cama está al lado del escritorio y hay lámparas",
            "En el cuarto hay un gato, también hay una cama y un escritorio con lámparas",
            "Las lámparas iluminan al gato que está en la alfombra cerca de la cama y el escritorio"
        ],
        correct: 0,
        category: "uso_preposiciones"
    },
    {
        question: "Selecciona la forma verbal correcta: 'Si yo _______ más tiempo, estudiaría otro idioma.'",
        options: [
            "tendría",
            "tuviera",
            "tenía",
            "tenga"
        ],
        correct: 1,
        category: "subjuntivo_condicional"
    },
    {
        question: "Elige la preposición correcta: 'María se dedica _____ enseñar español _____ extranjeros _____ hace cinco años.'",
        options: [
            "a / a / desde",
            "en / para / hace",
            "de / a / desde",
            "por / para / desde"
        ],
        correct: 0,
        category: "uso_preposiciones"
    },
    {
        question: "¿Qué tiempo verbal es correcto? 'Cuando _______ a casa, me llamó mi hermana.'",
        options: [
            "llegué",
            "he llegado",
            "llegaba",
            "había llegado"
        ],
        correct: 0,
        category: "tiempos_pasado"
    },
    {
        question: "Selecciona el adverbio adecuado: 'El tren llegó _______ a la estación porque hubo un problema técnico.'",
        options: [
            "tarde",
            "tardes",
            "tardemente",
            "tardío"
        ],
        correct: 0,
        category: "uso_adverbios"
    },
    {
        question: "Completa con el verbo en subjuntivo: 'Es necesario que _______ (tú) el formulario antes de viajar.'",
        options: [
            "rellenas",
            "rellenarás",
            "rellenes",
            "rellenaste"
        ],
        correct: 2,
        category: "subjuntivo_presente"
    },
    {
        question: "Elige la expresión temporal correcta: '_______ que empecé a aprender español, he hecho muchos amigos.'",
        options: [
            "Desde",
            "Hace",
            "Durante",
            "Mientras"
        ],
        correct: 0,
        category: "expresiones_temporales"
    },
    {
        question: "Lee el siguiente diálogo y elige la opción que completa la conversación:\n- ¿Te importaría prestarme tus apuntes?\n- _______",
        options: [
            "No, para nada. Te los traigo mañana",
            "Sí, me importa mucho",
            "No me importa nada",
            "Sí, tráelos mañana"
        ],
        correct: 0,
        category: "cortesía_pragmática"
    },
    {
        question: "¿Qué pronombre relativo completa correctamente la frase? 'La ciudad _____ vivo tiene un clima muy agradable.'",
        options: [
            "que",
            "donde",
            "cual",
            "quien"
        ],
        correct: 1,
        category: "pronombres_relativos"
    },
    {
        question: "Identifica el conector adecuado: 'No pude llegar temprano _______ había mucho tráfico.'",
        options: [
            "porque",
            "pero",
            "sino",
            "aunque"
        ],
        correct: 0,
        category: "conectores_discursivos"
    },
    {
        question: "Selecciona la perífrasis verbal correcta: 'Mi hermana _______ estudiar medicina el próximo año.'",
        options: [
            "va a",
            "está a",
            "viene de",
            "sigue de"
        ],
        correct: 0,
        category: "perífrasis_verbales"
    },
    {
        question: "¿Qué opción expresa mejor probabilidad en presente? 'Son las 10 y Juan no ha llegado, _______.'",
        options: [
            "estará enfermo",
            "está enfermo",
            "estuvo enfermo",
            "ha estado enfermo"
        ],
        correct: 0,
        category: "expresión_probabilidad"
    },
    {
        question: "Completa con el modo correcto: 'Te sugiero que _______ (ir) al médico.'",
        options: [
            "vas",
            "vayas",
            "irás",
            "fuiste"
        ],
        correct: 1,
        category: "subjuntivo_sugerencia"
    },
    {
        question: "Escucha el audio y selecciona la opción que mejor describe la situación:",
        audio: "path/to/conversation1.mp3",
        audioText: "Transcripción del audio (oculta hasta completar el ejercicio)",
        options: [
            "Una reserva en un restaurante",
            "Una cita médica",
            "Una compra de entradas",
            "Una consulta de horarios"
        ],
        correct: 0,
        category: "comprensión_auditiva"
    },
    {
        question: "¿Qué emoción expresa principalmente la persona que habla?",
        audio: "path/to/conversation2.mp3",
        audioText: "Transcripción del audio (oculta)",
        options: [
            "Entusiasmo",
            "Preocupación",
            "Indiferencia",
            "Sorpresa"
        ],
        correct: 1,
        category: "comprensión_emocional"
    },
    {
        question: "Escucha el audio y responde: ¿Dónde se celebran los carnavales más espectaculares según el hablante?",
        audio: "path/to/carnaval_espana.mp3",
        audioText: "En España se celebra mucho el carnaval, hay muchos carnavales y, bueno, los más espectaculares con diferencias son los de Tenerife y Gran Canaria, hay mucha fiesta en la calle, hace mucho calor, se preparan mucho los desfiles, los trajes.",
        options: [
            "Madrid y Barcelona",
            "Tenerife y Gran Canaria",
            "Sevilla y Valencia",
            "Cádiz y Málaga"
        ],
        correct: 1,
        category: "comprensión_auditiva"
    },
    {
        question: "Según el audio, ¿qué caracteriza a estos carnavales?",
        audio: "path/to/carnaval_espana.mp3",
        audioText: "En España se celebra mucho el carnaval, hay muchos carnavales y, bueno, los más espectaculares con diferencias son los de Tenerife y Gran Canaria, hay mucha fiesta en la calle, hace mucho calor, se preparan mucho los desfiles, los trajes.",
        options: [
            "Son muy tranquilos y familiares",
            "Tienen mucha fiesta en la calle y elaborados desfiles",
            "Son principalmente religiosos",
            "Se celebran en invierno con mucho frío"
        ],
        correct: 1,
        category: "inferencia_contextual"
    },
    {
        question: "¿Qué palabra se repite más en el audio?",
        audio: "path/to/carnaval_espana.mp3",
        audioText: "En España se celebra mucho el carnaval, hay muchos carnavales y, bueno, los más espectaculares con diferencias son los de Tenerife y Gran Canaria, hay mucha fiesta en la calle, hace mucho calor, se preparan mucho los desfiles, los trajes.",
        options: [
            "España",
            "Carnaval",
            "Mucho",
            "Fiesta"
        ],
        correct: 2,
        category: "atención_detalle"
    },
    {
        question: "Escucha el audio y responde: ¿Dónde se encuentra el glaciar Perito Moreno?",
        audio: "audio/quiz/argentina_glaciar.mp3",
        audioText: "En el sur de Argentina hace mucho frío por su proximidad con la con la Antártida, allí se encuentra el glaciar perito moreno, que es una gran extensión de hielo, atrae mucho turismo y es uno de los espectáculos naturales más grandes que hay en este planeta.",
        options: [
            "En el norte de Argentina",
            "En el sur de Argentina",
            "En la Antártida",
            "En Chile"
        ],
        correct: 1,
        category: "comprensión_auditiva"
    },
    {
        question: "Según el audio, ¿por qué hace mucho frío en el sur de Argentina?",
        audio: "audio/quiz/argentina_glaciar.mp3",
        audioText: "En el sur de Argentina hace mucho frío por su proximidad con la con la Antártida, allí se encuentra el glaciar perito moreno, que es una gran extensión de hielo, atrae mucho turismo y es uno de los espectáculos naturales más grandes que hay en este planeta.",
        options: [
            "Por la altitud de las montañas",
            "Por su proximidad con la Antártida",
            "Por las corrientes marinas",
            "Por el cambio climático"
        ],
        correct: 1,
        category: "relación_causa_efecto"
    },
    {
        question: "¿Qué error gramatical se comete en el audio?",
        audio: "audio/quiz/argentina_glaciar.mp3",
        audioText: "En el sur de Argentina hace mucho frío por su proximidad con la con la Antártida, allí se encuentra el glaciar perito moreno, que es una gran extensión de hielo, atrae mucho turismo y es uno de los espectáculos naturales más grandes que hay en este planeta.",
        options: [
            "Repetición de 'con la'",
            "Falta de artículo antes de 'Argentina'",
            "Uso incorrecto de 'allí'",
            "Falta de mayúscula en 'perito moreno'"
        ],
        correct: 0,
        category: "análisis_gramatical"
    }
]; 

// Función para verificar y corregir rutas de imágenes
function fixImagePaths() {
    if (!window.quizQuestions) return;
    
    console.log("🖼️ Verificando rutas de imágenes en preguntas...");
    
    window.quizQuestions.forEach((question, index) => {
        // Si la pregunta tiene una imagen
        if (question.image) {
            // Si la ruta comienza con "path/to/"
            if (question.image.startsWith('path/to/')) {
                // Extraer el nombre del archivo
                const fileName = question.image.split('/').pop();
                
                // Crear una ruta correcta (asumiendo que están en img/quiz/)
                const correctPath = `img/quiz/${fileName}`;
                
                console.log(`🔄 Corrigiendo ruta de imagen en pregunta ${index+1}: 
                    ${question.image} -> ${correctPath}`);
                
                // Actualizar la ruta
                question.image = correctPath;
            }
            
            // Verificar si la imagen existe (solo como información)
            const img = new Image();
            img.onload = () => console.log(`✅ Imagen encontrada: ${question.image}`);
            img.onerror = () => console.warn(`⚠️ Imagen no encontrada: ${question.image}`);
            img.src = question.image;
        }
        
        // Lo mismo para archivos de audio
        if (question.audio && question.audio.startsWith('path/to/')) {
            const fileName = question.audio.split('/').pop();
            const correctPath = `audio/quiz/${fileName}`;
            
            console.log(`🔄 Corrigiendo ruta de audio en pregunta ${index+1}: 
                ${question.audio} -> ${correctPath}`);
            
            question.audio = correctPath;
        }
    });
    
    console.log("✅ Verificación de rutas completada");
}

// Ejecutar la corrección de rutas cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', fixImagePaths);

// Función específica para arreglar las imágenes problemáticas
/*function fixSpecificImages() {
    if (!window.quizQuestions) return;
    
    // Mapeo de rutas problemáticas a rutas correctas
    const imageMapping = {
        'path/to/airport.png': 'img/quiz/airport.png',
        'path/to/tourists.png': 'img/quiz/tourists.png',
        'path/to/train.png': 'img/quiz/train.png',
        'path/to/cat.png': 'img/quiz/cat.png'
    };
    
    // Corregir rutas de imágenes específicas
    window.quizQuestions.forEach((question, index) => {
        if (question.image && imageMapping[question.image]) {
            console.log(`🔄 Corrigiendo imagen específica en pregunta ${index+1}:
                ${question.image} -> ${imageMapping[question.image]}`);
            question.image = imageMapping[question.image];
        }
    });
    
    // También crear un respaldo para imágenes que no existan
    window.quizQuestions.forEach((question, index) => {
        if (question.image) {
            // Verificar si la imagen existe
            const img = new Image();
            img.onload = () => console.log(`✅ Imagen cargada correctamente: ${question.image}`);
            img.onerror = () => {
                console.warn(`⚠️ Imagen no encontrada: ${question.image}, usando imagen de respaldo`);
                // Si la imagen no existe, usar una imagen de respaldo
                question.image = 'img/quiz/placeholder.jpg';
                // También agregar texto alternativo
                question.imageAlt = `Imagen no disponible para la pregunta ${index+1}`;
            };
            img.src = question.image;
        }
    });
}*/

// Llamar a esta función al cargar la página
document.addEventListener('DOMContentLoaded', fixSpecificImages);

// Función para corregir las imágenes faltantes
function fixMissingImages() {
    console.log("🖼️ Corrigiendo imágenes faltantes...");
    
    // Asegurarnos de que las preguntas están cargadas
    if (!window.quizQuestions || !Array.isArray(window.quizQuestions)) {
        console.error("❌ No se encontraron las preguntas");
        return;
    }
    
    // Corregir específicamente las preguntas 8, 9, 10 y 11 (índices 7, 8, 9 y 10)
    const problemQuestions = [7, 8, 9, 10];
    
    problemQuestions.forEach(index => {
        if (index < window.quizQuestions.length) {
            const question = window.quizQuestions[index];
            
            // Solo procesar si tiene una imagen
            if (question.image) {
                // Obtener nombre de archivo de la ruta actual
                const filename = question.image.split('/').pop();
                
                // Crear nueva ruta en la carpeta correcta
                const newPath = `img/quiz/${filename}`;
                
                console.log(`🔄 Pregunta ${index + 1}: Cambiando ${question.image} a ${newPath}`);
                question.image = newPath;
                
                // También agregar un respaldo por si la imagen sigue sin cargar
                question.originalImage = question.image;
                question.backupImage = 'img/quiz/placeholder.jpg';
            }
        }
    });
    
    // Modificar la forma en que se muestra la imagen para usar un respaldo
    modifyDisplayQuestionMethod();
    
    console.log("✅ Corrección de imágenes completada");
}

// Función para modificar el método displayQuestion de la clase Quiz
function modifyDisplayQuestionMethod() {
    if (!window.Quiz || !window.Quiz.prototype) {
        console.error("❌ No se pudo acceder a la clase Quiz");
        return;
    }
    
    // Guardar referencia al método original
    const originalCreateImageContainer = window.Quiz.prototype.createImageContainer;
    
    // Reemplazar con nuestra versión mejorada
    window.Quiz.prototype.createImageContainer = function(question) {
        if (!question.image) return '';
        
        return `
            <div class="image-container mb-4 text-center">
                <img src="${question.image}" 
                     alt="Imagen para pregunta ${this.currentQuestion + 1}"
                     class="img-fluid rounded"
                     style="max-height: 300px;"
                     onerror="this.onerror=null; this.src='img/quiz/placeholder.jpg'; 
                             this.style.border='2px dashed #dc3545'; 
                             this.parentNode.innerHTML += '<p class=\\'text-danger mt-2\\'>Imagen no disponible</p>';">
            </div>
        `;
    };
    
    console.log("✓ Método createImageContainer modificado para manejar imágenes faltantes");
}

// Ejecutar cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
    // Dar tiempo para que se carguen todas las dependencias
    setTimeout(fixMissingImages, 500);
    
    // También comprobar periódicamente el botón de envío
    setInterval(function() {
        const quizIntro = document.getElementById('quizIntro');
        const submitContainer = document.getElementById('submitContainer');
        
        if (quizIntro && submitContainer) {
            const isIntroVisible = window.getComputedStyle(quizIntro).display !== 'none';
            
            if (isIntroVisible) {
                submitContainer.style.display = 'none';
            }
        }
    }, 1000);
}); 